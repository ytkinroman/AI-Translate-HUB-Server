# Сервер перевода текста

Серверное приложение для асинхронного перевода текста с использованием различных сервисов перевода (DeepL, Google, Yandex). Взаимодействие между компонентами осуществляется через RabbitMQ, а получение результатов происходит в реальном времени через WebSocket соединение.

## Основные возможности

- Интеграция с популярными сервисами перевода:
  - DeepL (высокое качество перевода)
  - Google Translate (широкая поддержка языков)
  - Yandex.Translate (хорошая поддержка русского языка)
- Асинхронная обработка запросов через систему очередей RabbitMQ
- Получение результатов в реальном времени через WebSocket
- Горизонтальное масштабирование благодаря поддержке нескольких воркеров
- Отказоустойчивая архитектура с восстановлением после сбоев
- Подробное логирование всех операций
- Интеграция с Telegram ботом (опционально)

## Системные требования

### Программное обеспечение
- Python версии 3.12 или выше
- RabbitMQ сервер
- Redis сервер
- API ключи сервисов перевода:
  - DeepL API ключ ([получить здесь](https://www.deepl.com/pro#developer))
  - Google Cloud Translate API ключ ([инструкция](https://cloud.google.com/translate/docs/setup))
  - Yandex.Cloud API ключ ([инструкция](https://cloud.yandex.ru/docs/translate/quickstart))

### Рекомендуемые системные ресурсы
- RAM: минимум 2GB
- CPU: 2+ ядра
- Диск: 1GB свободного места

## Установка и настройка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd trans-server
```

2. Создайте и активируйте виртуальное окружение Python:
```bash
python -m venv .venv
source .venv/bin/activate  # для Linux/macOS
.venv\Scripts\activate     # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Настройка конфигурации:
   - Скопируйте `config.example.py` в `config.py`
   - Заполните необходимые параметры в `config.py`:
     - API ключи сервисов перевода
     - Параметры подключения к RabbitMQ и Redis
     - Настройки безопасности
     - Параметры логирования

## Запуск сервера

1. Убедитесь, что необходимые сервисы запущены:
   - RabbitMQ: `rabbitmq-server`
   - Redis: `redis-server`

2. Запустите сервер:
```bash
uvicorn app:app --reload --host 0.0.0.0 --port 8000 --workers 4
```

Параметры запуска:
- `--workers N` - количество воркеров uvicorn (рекомендуется: число_ядер * 2)
- `NUM_WORKERS=N` - количество RabbitMQ воркеров (через переменную окружения)
- `--reload` - автоперезагрузка при изменении кода (только для разработки)

## API

### WebSocket API

1. Подключение:
```javascript
const ws = new WebSocket('ws://localhost:8000/ws');
```

2. Получение ID сессии:
```javascript
ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.type === 'connection_established') {
        const sessionId = data.session_id;
        // Сохраните sessionId для использования в запросах
    }
};
```

### HTTP API

#### Перевод текста

```http
POST /translate
Content-Type: application/json

{
    "text": "Текст для перевода",
    "translator_type": "deepl",  // или "google", "yandex"
    "source_lang": "auto",       // или конкретный код языка
    "target_lang": "ru",        // целевой язык
    "ws_session_id": "id_сессии"
}
```

Ответ:
```json
{
    "status": "success",
    "message": "Запрос на перевод принят"
}
```

## Архитектура

### Компоненты системы

- **FastAPI**: основной веб-фреймворк
  - Обработка HTTP запросов
  - WebSocket соединения
  - Асинхронная работа
  
- **RabbitMQ**: система очередей
  - Очередь запросов на перевод
  - Очередь результатов
  - Обеспечение надежности доставки

- **Redis**: кэширование и состояние
  - Хранение активных WebSocket соединений
  - Кэширование частых переводов
  - Временное хранение состояния

### Процесс перевода

1. Клиент устанавливает WebSocket соединение
2. Отправляет HTTP запрос на перевод
3. Запрос помещается в очередь RabbitMQ
4. Воркер получает задачу и выполняет перевод
5. Результат отправляется клиенту через WebSocket

## Логирование

Настройка логирования производится в config.py:
- Уровень логирования (DEBUG, INFO, WARNING, ERROR)
- Формат сообщений
- Место хранения логов

Логируются следующие события:
- Подключения к RabbitMQ/Redis
- Запросы на перевод
- Результаты переводов
- Ошибки и исключения
- Действия воркеров

## Безопасность

### Рекомендации

1. В продакшене:
   - Используйте HTTPS
   - Настройте CORS правильно
   - Ограничьте число соединений
   
2. Защита данных:
   - Храните ключи API в переменных окружения
   - Используйте безопасные пароли
   - Регулярно обновляйте зависимости

3. Мониторинг:
   - Следите за логами
   - Настройте оповещения об ошибках
   - Контролируйте использование ресурсов

## Лицензия

MIT
